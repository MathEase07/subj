<!DOCTYPE html>
<html lang="tl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sa Huling Jeep ng Gabi — Subtitles</title>
  <style>
    :root {
      --bg: #000;
      --fg: #fff;
      --muted: rgba(255,255,255,0.65);
    }
    html,body {
      height:100%;
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family: "Arial", Helvetica, sans-serif;
    }
    .wrap {
      display:flex;
      flex-direction:column;
      height:100%;
      align-items:center;
      justify-content:center;
      padding:20px;
      box-sizing:border-box;
      text-align:center;
    }
    #subtitle {
      font-family: 'MistakeNote', "Segoe UI", Roboto, Arial, sans-serif;
      color: #ff0000; /* red */
      font-size: clamp(18px, 4vw, 30px);
      line-height:1.4;
      max-width: 92%;
      background: rgba(0,0,0,0.45);
      padding: 18px 22px;
      border-radius: 12px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.6);
      transition: opacity .35s, transform .35s;
      opacity: 1;
    }
    #time {
      margin-top:12px;
      color: var(--muted);
      font-size: 0.85rem;
    }
    /* small helper for debugging */
    #debug {
      position:fixed;
      left:8px;
      bottom:8px;
      color:var(--muted);
      font-size:12px;
      opacity:0.9;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div id="subtitle">“Sa Huling Jeep ng Gabi”</div>
    <div id="time"></div>
  </div>
  <div id="debug" style="display:none;"></div>

<script>
/*
  Generated subtitles for "Sa Huling Jeep ng Gabi"
  - The script provided by the user was parsed as sequential phrases with durations (e.g., (3s)).
  - Each subtitle entry has a start time in seconds (cumulative) and the visible text (without the (Ns) markers).
  - Controls: App Inventor should set WebViewer.WebViewString to "play", "pause", or "stop".
  - There's also a setOffset(seconds) function to shift all subtitle timings (if audio has lead-in silence).
*/

/* === Subtitles array ===
   Each item: { t: <start seconds>, text: "<subtitle text>" }
   This block follows the Chunk 1 timestamps you provided (Opening & Scene 1).
*/
const subtitles = [
  { t: 0, text: "..." },
  { t: 23, text: "Sa lahat ng hindi inaasahan sa buhay, tulad ng sabayang pagpatak ng ulan at LBM, o yung pag-message mo sa crush mo na isi-seen lang — walang mas nakakagulat kaysa sa pagbabalik ng isang taong hindi mo na inakalang babalik pa." },
  { t: 31, text: "Ito ang kwento ni Bea… at ng isang jeepney ride na magbabago ng lahat." },
  { t: 38, text: "..." },
  { t: 40, text: "Gabi na sa Sariaya." },
  { t: 42, text: "Si Bea, galing sa kanyang part-time, pagod, gutom, at basa sa ulan." },
  { t: 48, text: "Sa loob ng jeep, may tatlong pasahero — isa ay tulog, isa kumakain ng fishball, at isa... ang ex niyang si Paolo." },
  { t: 57, text: "..." },
  { t: 63, text: "Ay wow." },
  { t: 64, text: "Si Mr. Ghoster." },
  { t: 65, text: "Buhay ka pa pala." },
  { t: 67, text: "Bea?!" },
  { t: 68, text: "Uy, hala, ikaw nga! Grabe, ang ganda mo pa rin!" },
  { t: 75, text: "Wag mo akong daanin sa bola. Hindi ako siopao." },
  { t: 83, text: "Bago pa mangyari ang lahat ng ‘to, si Bea at si Paolo ay may kwento. Isang kwento ng mga unang ngiti, at ng mga unang halakhak sa gitna ng mga kape at kwentuhan." },
  { t: 93, text: "Nagkakilala sila sa isang coffee shop sa Barangay Poblacion 2, Sariaya, Quezon," },
  { t: 98, text: "sa likod ng Ongville, to be exact sa Brewleaf — isang lugar na puno ng kwento, at puno ng tamis ng mga simula." },
  { t: 105, text: "Si Beatriz Gabrielle Castillo, also known as Bea, isang independent na babae, outgoing at madaldal." },
  { t: 113, text: "Siya yung tipo ng tao na laging game sa usapan," },
  { t: 117, text: "hindi nauubusan ng kwento, at mahilig magpuyat para mag-binge watch ng mga paborito niyang series hanggang madaling araw." },
  { t: 126, text: "Si Paolo Antonio Villanueva," },
  { t: 130, text: "isang dedicated na athlete na laging puno ng energy." },
  { t: 134, text: "Medyo playful siya at mahilig magbiro," },
  { t: 137, text: "kaya kahit seryoso ang training ay nagagawa niyang gawing masaya ang paligid." },
  { t: 142, text: "Natural sa kanya ang pagiging palakaibigan, at may confidence siyang nakakahawa — tipong kaya niyang pasayahin ang kahit sinong kasama niya." },
  { t: 147, text: "..." },
  { t: 149, text: "Excuse me, miss… may free WiFi ba dito? Kasi feeling ko mas mabilis ang connection kung sayo ako makikipag-usap." },
  { t: 158, text: "Free WiFi? Kung paanong libre ang utang ng mga kababayan mo sa mga kaibigan nila, 'free' lang yan." },
  { t: 164, text: "Grabe ka naman, ha! Hindi ba pwedeng magtanong lang… syempre may kasamang charm, para hindi lang ako sa court mabilis maka-score." },
  { t: 170, text: "Pwede ba maki-table? Full-house na eh. I’m Paolo by the way." },
  { t: 175, text: "Bea, ayan na siya! Baka ito siya na yung Mr. Right na hinahanap mo! Tall, check, mestizo, check, handsome, oh super check. Hindi mo ba siya tatanggapin?" },
  { t: 199, text: "Si Trina, ang best friend ni Bea, ang palaging kasangga sa mga ganitong moments. Hindi siya tinatablan ng hiya at mahilig magbiro, lalo na kapag si Bea ang topic." },
  { t: 213, text: "Trina, sobra ang pagka-OA ha!" },
  { t: 219, text: "Ikalma mo and yes Paolo, pwede ka maki-table. I’m Bea and itong OA na katabi ko, si Trina nga pala." },
  { t: 231, text: "Thanks. Wait, sabi na eh familiar ka! You’re Ms. Castillo, right? Si Ms. Top 1 since junior high school, na kulang nalang i-perfect niya lahat ng quizzes and exams. It’s nice to finally meet my idol in person." },
  { t: 238, text: "Yes, that’s me, Mr. MVP ng basketball ng intramurals 2024." },
  { t: 243, text: "So ano ko dito? Third wheel ganun?" },
  { t: 249, text: "Sinong maga-akala na dito na pala magsisimula ang pagkaka-ibigan, este pagkakaibigan ng dalawa." },
  { t: 256, text: "It was not hard na maging close yung dalawa, considering na they’re schoolmates from the same school and grade level." },
  { t: 263, text: "Ano nga bang mangyayari sa kanilang friendship? We’ll be giving you the next latest tea of the story after this short break." },
  { t: 273, text: "..." },
  { t: 293, text: "..." }
];

/* === Communication with MIT App Inventor ===
   MIT AI2 (WebViewer) can call setWebViewString to send commands.
   We'll poll window.AppInventor.getWebViewString() if available (common pattern).
   Accept commands:
     play  -> start/resume
     pause -> pause
     stop  -> stop/reset
     time:NNN -> set current time (in seconds)  e.g. "time:45.3"
     offset:NNN -> set timing offset in seconds (positive or negative)
*/
let lastCmd = "";

function processCommand(cmd) {
  if (!cmd) return;
  if (cmd === lastCmd) return; // nothing new
  lastCmd = cmd;
  // parse possible values
  if (cmd === "play") {
    doPlay();
  } else if (cmd === "pause") {
    doPause();
  } else if (cmd === "stop") {
    doStop();
  } else if (cmd.startsWith("time:")) {
    const v = parseFloat(cmd.split(":")[1]);
    if (!isNaN(v)) setTime(v);
  } else if (cmd.startsWith("offset:")) {
    const v = parseFloat(cmd.split(":")[1]);
    if (!isNaN(v)) setOffset(v);
  } else {
    // ignore unknown
    // show debug if needed
    //document.getElementById('debug').innerText = "Unknown cmd: " + cmd;
  }
}

/* Polling strategy (works for App Inventor WebViewer):
   App Inventor sets WebViewer.WebViewString to a value which becomes accessible via
   window.AppInventor.getWebViewString() inside the web page. We'll poll it every 300ms.
*/
function pollForCommands() {
  try {
    if (window.AppInventor && typeof window.AppInventor.getWebViewString === "function") {
      const cmd = window.AppInventor.getWebViewString();
      if (cmd && cmd.length) {
        processCommand(cmd.trim());
        // Clear webview string (if the environment supports set)
        if (typeof window.AppInventor.setWebViewString === "function") {
          window.AppInventor.setWebViewString(""); // reset on supported hosts
        }
      }
    } else {
      // fallback: some AI2 versions call setWebViewString with incoming messages,
      // but if not present, App Inventor can also call JS functions—however polling is safe.
    }
  } catch (e) {
    // ignore
  }
}
setInterval(pollForCommands, 300);

/* Expose functions for direct JS calling (if you want to call from App Inventor via EvaluateJavaScript) */
window.subtitleControls = {
  play: doPlay,
  pause: doPause,
  stop: doStop,
  setTime: setTime,
  setOffset: setOffset
};

/* initialize */
doStop(); // show initial message
</script>
</body>
</html>
